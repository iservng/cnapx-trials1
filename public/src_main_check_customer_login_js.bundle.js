"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkcnapx_trials"] = self["webpackChunkcnapx_trials"] || []).push([["src_main_check_customer_login_js"],{

/***/ "./src/main/check_customer_login.js":
/*!******************************************!*\
  !*** ./src/main/check_customer_login.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CheckCustomerLogin: () => (/* binding */ CheckCustomerLogin)\n/* harmony export */ });\n/* harmony import */ var _utils_src_toast_it_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils_src/toast_it.js */ \"./src/utils_src/toast_it.js\");\n/* harmony import */ var firebase_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase/auth */ \"./node_modules/firebase/auth/dist/esm/index.esm.js\");\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! firebase/firestore */ \"./node_modules/firebase/firestore/dist/esm/index.esm.js\");\n\r\n\r\n\r\n// import { getFirestore } from \"firebase/firestore\";}\r\n\r\nclass CheckCustomerLogin \r\n{\r\n    #_mErrors;\r\n    #mErrorMsg;\r\n    #email;\r\n    #password;\r\n    #auth;\r\n    #db;\r\n\r\n    constructor(form)\r\n    {\r\n        this.#_mErrors = 0;\r\n        this.#mErrorMsg = '';\r\n        if(!form)\r\n        {\r\n            this.#_mErrors++;\r\n            this.#mErrorMsg = 'Invalid Form Submission';\r\n        }\r\n        else \r\n        {\r\n            //Extract the email and the password\r\n            let email = form.email.value.trim();\r\n            let password = form.password.value.trim();\r\n\r\n            if(!email)\r\n            {\r\n                this.#_mErrors++;\r\n                this.#mErrorMsg = 'Invalid Email!';\r\n            }\r\n            else if(!password)\r\n            {\r\n                this.#_mErrors++;\r\n                this.#mErrorMsg = 'Invalid Password!';\r\n            }\r\n            else \r\n            {\r\n                this.#email = email;\r\n                this.#password = password;\r\n                this.#auth = (0,firebase_auth__WEBPACK_IMPORTED_MODULE_1__.getAuth)();\r\n                this.#db = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_2__.getFirestore)();\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    validateOrWarn()\r\n    {\r\n        if(this.#_mErrors == 0)\r\n        {\r\n            /**\r\n             * First the authenticator is used to sign this user in\r\n             */\r\n            (0,firebase_auth__WEBPACK_IMPORTED_MODULE_1__.signInWithEmailAndPassword)(this.#auth, this.#email, this.#password)\r\n            .then((userCredential) => {\r\n                // Signed in \r\n                const user = userCredential.user;\r\n                this.#getUserToDashboard(user);\r\n\r\n            })\r\n            .catch((error) => {\r\n\r\n                const errorCode = error.code;\r\n                const errorMessage = error.message;\r\n                console.log(errorMessage);\r\n                (0,_utils_src_toast_it_js__WEBPACK_IMPORTED_MODULE_0__.toastIt)('red', 'Invalid Login or Network Connection Error');\r\n                document.querySelector('.loginBtnDiv').innerHTML = `\r\n                <input type=\"submit\" class=\"btn white-text text-darken-3 purple darken-3 z-depth-1\" value=\"Validate User\">`;\r\n                \r\n            });\r\n\r\n        }\r\n        else \r\n        {\r\n            console.log(this.#mErrorMsg);\r\n            (0,_utils_src_toast_it_js__WEBPACK_IMPORTED_MODULE_0__.toastIt)('red', this.#mErrorMsg);\r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    async #getUserToDashboard(user)\r\n    {\r\n        let colref = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_2__.collection)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_2__.getFirestore)(), 'cnapx-customer');\r\n        const q = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_2__.query)(colref, (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_2__.where)('email', '==', user.email), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_2__.where)('activated', '==', true));\r\n\r\n        const querySnapshot = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_2__.getDocsFromServer)(q);\r\n\r\n        console.log('querySnapshot =', querySnapshot);\r\n        \r\n            /**************************\r\n             * Using a switch-statement we determine the type of user and call for the appropriate dashboard.\r\n             */\r\n            switch (querySnapshot.docs[0].data().userType) \r\n            {\r\n                case 'marchant':\r\n                    this.#directToMarchantDashboard(querySnapshot.docs[0].data());\r\n                    break;\r\n\r\n                case 'individual':\r\n                    this.#directToIndividualDashboard(querySnapshot.docs[0].data());\r\n                    break;\r\n\r\n                case 'agent':\r\n                    let agentData = querySnapshot.docs[0].data();\r\n                    let agentId = querySnapshot.docs[0].id;\r\n                    this.#directToAgentDashboard(agentData, agentId);\r\n                    break;\r\n\r\n                    case 'admin':\r\n                    this.#directToAdminDashboard(querySnapshot.docs[0].data());\r\n                    break;\r\n\r\n                case 'marketing':\r\n                    //marketingManagerId\r\n                    let marketingManagerData = querySnapshot.docs[0].data();\r\n                    let marketingManagerId = querySnapshot.docs[0].id;\r\n                    this.#directToMarketingDashboard(querySnapshot.docs[0].data(), marketingManagerId);\r\n                    break;\r\n\r\n                case 'financial':\r\n                    this.#directToFinanceDashboard(querySnapshot.docs[0].data());\r\n                    break;\r\n                    \r\n                default:\r\n                    break;\r\n            }\r\n\r\n        \r\n\r\n        \r\n        \r\n\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n    // MARCHANT DASHBOARD\r\n    // ---------------------\r\n    #directToMarchantDashboard(userdata)\r\n    {\r\n        /**\r\n        * This is where this checker class calls the customer-profile-interface and displays it.\r\n        * save marchant information to session\r\n        */\r\n        sessionStorage.setItem('marchantInfo', JSON.stringify(userdata));\r\n        \r\n        if(document.querySelector('header'))\r\n        {\r\n            let header = document.querySelector('header');\r\n            header.style.display = 'block';\r\n        }\r\n\r\n        Promise.all(/*! import() */[__webpack_require__.e(\"src_main_marchant_customer_profile_dashboard_js\"), __webpack_require__.e(\"src_utils_src_remove_landing_page_sections_js-src_utils_src_remove_modal_js-_d1e0-_da581\")]).then(__webpack_require__.bind(__webpack_require__, /*! ./marchant_customer_profile_dashboard.js */ \"./src/main/marchant_customer_profile_dashboard.js\"))\r\n        .then(m => {\r\n            let customer_profile_dashboard = new m.CustomerProfileDashboard();\r\n            customer_profile_dashboard.createUi();\r\n        })\r\n        .catch(error => {\r\n            console.log(error.message);\r\n        });\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // INDIVIDUAL DASHBOARD\r\n    // ---------------------\r\n    #directToIndividualDashboard(userdata)\r\n    {\r\n        sessionStorage.setItem('marchantInfo', JSON.stringify(userdata));\r\n        if(document.querySelector('header'))\r\n            document.querySelector('header').style.display = 'block';\r\n        \r\n        \r\n        //Import the individual class profiler\r\n        __webpack_require__.e(/*! import() */ \"src_main_individual_customer_profile_dashboard_js\").then(__webpack_require__.bind(__webpack_require__, /*! ./individual_customer_profile_dashboard.js */ \"./src/main/individual_customer_profile_dashboard.js\"))\r\n        .then(m => {\r\n            let dashboard = new m.IndividualProfileDashboard();\r\n            dashboard.createUi();\r\n        })\r\n        .catch(error => {\r\n            console.log(error.message);\r\n            (0,_utils_src_toast_it_js__WEBPACK_IMPORTED_MODULE_0__.toastIt)('red', 'Unable to load the individual profile');\r\n        });\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    // AGENT DASHBOARD\r\n    // ---------------------#directToAgentDashboard(agentData, agentId)\r\n    #directToAgentDashboard(userdata, userId)\r\n    {\r\n        sessionStorage.setItem('agentData', JSON.stringify(userdata));\r\n        sessionStorage.setItem('agentId', userId);\r\n\r\n        if(document.querySelector('header'))\r\n            document.querySelector('header').style.display = 'block';\r\n        \r\n        //Import the individual class profiler.\r\n        Promise.all(/*! import() */[__webpack_require__.e(\"src_main_agent_customer_profile_dashboard_js\"), __webpack_require__.e(\"src_utils_src_remove_landing_page_sections_js-src_utils_src_remove_modal_js-_d1e0-_da582\")]).then(__webpack_require__.bind(__webpack_require__, /*! ./agent_customer_profile_dashboard.js */ \"./src/main/agent_customer_profile_dashboard.js\"))\r\n        .then(m => {\r\n            let dashboard = new m.AgentProfileDashboard(userId);\r\n            dashboard.createUi();\r\n        })\r\n        .catch(error => {\r\n            console.log(error.message);\r\n            (0,_utils_src_toast_it_js__WEBPACK_IMPORTED_MODULE_0__.toastIt)('red', 'Unable to load the individual profile');\r\n        });\r\n\r\n    }//\r\n\r\n\r\n\r\n\r\n    #directToAdminDashboard(userdata)\r\n    {\r\n        sessionStorage.setItem('marchantInfo', JSON.stringify(userdata));\r\n        if(document.querySelector('header'))\r\n            document.querySelector('header').style.display = 'block';\r\n        \r\n        \r\n        //Import the individual class profiler\r\n        Promise.all(/*! import() */[__webpack_require__.e(\"src_main_admin_customer_profile_dashboard_js\"), __webpack_require__.e(\"src_utils_src_remove_landing_page_sections_js-src_utils_src_remove_modal_js-_d1e0-_da580\")]).then(__webpack_require__.bind(__webpack_require__, /*! ./admin_customer_profile_dashboard.js */ \"./src/main/admin_customer_profile_dashboard.js\"))\r\n        .then(m => {\r\n            let dashboard = new m.AdminProfileDashboard();\r\n            dashboard.createUi();\r\n        })\r\n        .catch(error => {\r\n            console.log(error.message);\r\n            (0,_utils_src_toast_it_js__WEBPACK_IMPORTED_MODULE_0__.toastIt)('red', 'Unable to load the Admin profile');\r\n        });\r\n    }\r\n\r\n\r\n    #directToMarketingDashboard(userdata, id)\r\n    {\r\n        // console.log(userdata);\r\n        sessionStorage.setItem('marchantInfo', JSON.stringify(userdata));\r\n        sessionStorage.setItem('marketingManagerId', id);\r\n        if(document.querySelector('header'))\r\n            document.querySelector('header').style.display = 'block';\r\n        \r\n        \r\n        //Import the individual class profiler..\r\n        Promise.all(/*! import() */[__webpack_require__.e(\"src_main_marketing_customer_profile_dashboard_js\"), __webpack_require__.e(\"src_utils_src_remove_landing_page_sections_js-src_utils_src_remove_modal_js-src_utils_src_sma-4c91af\")]).then(__webpack_require__.bind(__webpack_require__, /*! ./marketing_customer_profile_dashboard.js */ \"./src/main/marketing_customer_profile_dashboard.js\"))\r\n        .then(m => {\r\n            let dashboard = new m.MarketingProfileDashboard();\r\n            dashboard.createUi();\r\n        })\r\n        .catch(error => {\r\n            console.log(error.message);\r\n            (0,_utils_src_toast_it_js__WEBPACK_IMPORTED_MODULE_0__.toastIt)('red', 'Unable to load the Marketing profile');\r\n        });\r\n\r\n    }\r\n\r\n\r\n    #directToFinanceDashboard(userdata)\r\n    {\r\n        // console.log(userdata);\r\n        sessionStorage.setItem('marchantInfo', JSON.stringify(userdata));\r\n        if(document.querySelector('header'))\r\n            document.querySelector('header').style.display = 'block';\r\n        \r\n        \r\n        //Import the individual class profiler//FinanceProfileDashboard\r\n        __webpack_require__.e(/*! import() */ \"src_main_finance_customer_profile_dashboard_js\").then(__webpack_require__.bind(__webpack_require__, /*! ./finance_customer_profile_dashboard.js */ \"./src/main/finance_customer_profile_dashboard.js\"))\r\n        .then(m => {\r\n            let dashboard = new m.FinanceProfileDashboard();\r\n            dashboard.createUi();\r\n        })\r\n        .catch(error => {\r\n            console.log(error.message);\r\n            (0,_utils_src_toast_it_js__WEBPACK_IMPORTED_MODULE_0__.toastIt)('red', 'Unable to load the Finance profile');\r\n        });\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n}\r\n\n\n//# sourceURL=webpack://cnapx-trials/./src/main/check_customer_login.js?");

/***/ })

}]);