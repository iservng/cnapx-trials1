"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkcnapx_trials"] = self["webpackChunkcnapx_trials"] || []).push([["src_modal_handlers_process_customer_registration_type_js"],{

/***/ "./src/modal/handlers/process_customer_registration_type.js":
/*!******************************************************************!*\
  !*** ./src/modal/handlers/process_customer_registration_type.js ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ProcessCustomerRegistrationType: () => (/* binding */ ProcessCustomerRegistrationType)\n/* harmony export */ });\n/* harmony import */ var _utils_small_spinner_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../utils/small_spinner.js */ \"./src/utils/small_spinner.js\");\n/* harmony import */ var _utils_toast_it_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../utils/toast_it.js */ \"./src/utils/toast_it.js\");\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! firebase/firestore */ \"./node_modules/firebase/firestore/dist/esm/index.esm.js\");\n/* harmony import */ var firebase_auth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! firebase/auth */ \"./node_modules/firebase/auth/dist/esm/index.esm.js\");\n/* harmony import */ var _utils_insert_into_DOM_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../utils/insert_into_DOM.js */ \"./src/utils/insert_into_DOM.js\");\n\r\n\r\n\r\n\r\n\r\n\r\nclass ProcessCustomerRegistrationType \r\n{\r\n    #_mErrors;\r\n    #mErrorMsg;\r\n    #typeSelectBtn;\r\n    #customerData;\r\n    #auth;\r\n    #db; \r\n    #customerType;\r\n    #customerName;\r\n    #colRef;\r\n    constructor(typeSelected)\r\n    {\r\n        this.#_mErrors = 0;\r\n        this.#mErrorMsg = '';\r\n        if(!typeSelected)\r\n        {\r\n            this.#_mErrors++;\r\n            this.#mErrorMsg = \"Please select type\";\r\n        }\r\n        else \r\n        {\r\n            this.#typeSelectBtn = typeSelected;\r\n            this.#customerData = JSON.parse(sessionStorage.getItem('customerInfo'));\r\n            this.#auth = (0,firebase_auth__WEBPACK_IMPORTED_MODULE_3__.getAuth)();\r\n            this.#db = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_2__.getFirestore)();\r\n            this.#customerName = this.#customerData['name'].toUpperCase();\r\n            this.#colRef = 'cnapx-customer';\r\n\r\n        }\r\n        \r\n    }\r\n\r\n\r\n    //Public API\r\n    processType()\r\n    {\r\n        if(this.#_mErrors == 0)\r\n        {\r\n            this.#customerType = this.#typeSelectBtn.dataset.customertype;\r\n            (0,_utils_small_spinner_js__WEBPACK_IMPORTED_MODULE_0__.smallSpinner)('Working...', 'main');\r\n\r\n            /**************************************\r\n             * Import and execute the customer profile interface dashboard\r\n             * ------------------------------------------------------------\r\n             */\r\n            switch (this.#customerType) \r\n            {\r\n                case \"marchant\":\r\n                    this.#customerType = 'marchant';\r\n                    this.#registerCustomerAsMarchant(this.#customerType);\r\n                    break;\r\n\r\n                case \"individual\": \r\n                    this.#customerType = \"individual\";\r\n                    this.#registerCustomerAsMarchant(this.#customerType);\r\n                    break;\r\n\r\n                default:\r\n                    (0,_utils_toast_it_js__WEBPACK_IMPORTED_MODULE_1__.toastIt)('red', 'Could not determine registration type');\r\n                    break;\r\n\r\n            }\r\n            \r\n        }\r\n        else \r\n        {\r\n            (0,_utils_toast_it_js__WEBPACK_IMPORTED_MODULE_1__.toastIt)('red', this.#mErrorMsg);\r\n            console.log(this.#mErrorMsg);\r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n    async #registerCustomerAsMarchant(userType)\r\n    {\r\n\r\n        this.#customerData['userType'] = userType;\r\n        // sessionStorage.setItem('agentId', JSON.stringify(userId));\r\n        //If this is signed in and is registering from his profile-page.\r\n        if(sessionStorage.getItem('agentId'))\r\n        {\r\n            let agentId = sessionStorage.getItem('agentId');\r\n            // console.log();\r\n            this.#customerData['agentCode'] = agentId;\r\n        }\r\n        // if(sessionStorage.)\r\n\r\n        /**\r\n         * This user has \r\n         * 1. Provided his information\r\n         * 2. Privided his customer type information\r\n         * Now we need to create an authentication account with the provided credentials//processType\r\n         */\r\n\r\n        (0,firebase_auth__WEBPACK_IMPORTED_MODULE_3__.createUserWithEmailAndPassword)(this.#auth, this.#customerData['email'], this.#customerData['password'])\r\n        .then(userCredentials => {\r\n\r\n            let user  = userCredentials.user;\r\n\r\n            /**\r\n             * This here is a prove that this user has successfully created an auth account, \r\n             * 1. we are gonna take his provided information an store it in the marchant-customer collection\r\n             * \r\n             */\r\n            this.#addUserToDB();\r\n            /* \r\n             * 2. The call the class-function that gives him feed-back saying all is registered you can sign in using you email and pasword\r\n             */\r\n\r\n        })\r\n        .catch(error => {\r\n            console.log(error.message);\r\n            (0,_utils_toast_it_js__WEBPACK_IMPORTED_MODULE_1__.toastIt)('red', 'Error: Use a unique email and ensure device has connection');\r\n            //Call the function that tell email-already-in-use\r\n            this.#credentialsNotUnique(this.#customerData['email'], this.#customerData['password']);\r\n        });\r\n\r\n    }\r\n\r\n\r\n    async #addUserToDB()\r\n    {\r\n        // Add a new document with a generated id.\r\n        // Add the \"createdOn\" property.\r\n        delete this.#customerData.password;\r\n        this.#customerData['createdOn'] = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_2__.serverTimestamp)();\r\n        this.#customerData['activated'] = true;\r\n        const docRef = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_2__.addDoc)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_2__.collection)(this.#db, this.#colRef), this.#customerData);\r\n        if(docRef.id)\r\n        {\r\n            //Automatically log user out\r\n            (0,firebase_auth__WEBPACK_IMPORTED_MODULE_3__.signOut)(this.#auth)\r\n            .then(() => {\r\n                /**\r\n                * This user information has been added to the database, and signedOut then the user can now be shown the welcome ui\r\n                */\r\n                this.#showTheSignupWelcomeMsg(this.#customerType);\r\n            })\r\n            .catch(error => {\r\n                (0,_utils_toast_it_js__WEBPACK_IMPORTED_MODULE_1__.toastIt)('red', 'Could not sign user out');\r\n                console.log(error.message);\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n    #showTheSignupWelcomeMsg(userType)\r\n    {\r\n        let dashboard = `<p><a href=\"#\" class=\"btn-flat dashboard\">Dashboard</a></p>`;\r\n        if(sessionStorage.getItem('agentId'))\r\n            dashboard = `<p><a href=\"#\" class=\"btn-flat agent_dashboard\">Dashboard</a></p>`;\r\n        \r\n\r\n        let content = `\r\n        <div class=\"container\">\r\n            <div class=\"row\" style=\"margin-top: 3rem;\">\r\n                <div class=\"col s12 center-align\" style=\"margin-bottom: 2rem;\">    \r\n                    <h4>\r\n                        <small>\r\n                            <b class=\"purple-text text-darken-3\">\r\n                                Congratulations\r\n                            </b>\r\n                        </small>\r\n                    </h4>\r\n                </div>\r\n\r\n                <div class=\"col s12 m3 l3\">\r\n                    ${dashboard}\r\n\r\n                    <p>\r\n                        <a href=\"#\" class=\"btn-flat sidenav-trigger purple-text text-darken-4\" data-target=\"mobile-demo\">\r\n                            Menu\r\n                        </a>\r\n                    </p>\r\n                </div>\r\n\r\n                <form action=\"\" id=\"signupCompletedForm\">\r\n                    <div class=\"col s12 m6 l6\">\r\n\r\n                        <div class=\"card-panel lighten-4 z-depth-1\" style=\"border: 1px solid white;\">\r\n                            <div class=\"\">\r\n                                <p><b>Dear, </b></p>\r\n                                <h5>\r\n                                    <b>${this.#customerName}</b>\r\n                                </h5>\r\n                                \r\n                            </div>\r\n                            <p>\r\n                                Welcome to CnapxPay!\r\n                            </p>\r\n                            <p>\r\n                                We are thrilled to have you join our community of tech enthusiasts! Thank you for choosing us to be a part of your journey.\r\n                            </p>\r\n                            <p>\r\n                                As a new ${userType} member, you now have access to a world of exciting opportunities, exclusive offers, and top-notch services. Whether you're here to explore new experiences, indulge in your passions, or simply connect with like-minded individuals, we're here to make every moment unforgettable.\r\n                            </p>\r\n                            <p>\r\n                                Feel free to dive into our platform and discover all that we have to offer. Should you have any questions or need assistance along the way, our dedicated support team is here to help you every step of the way.\r\n                            </p>\r\n                            <p>\r\n                                Once again, welcome aboard! We can't wait to embark on this adventure with you.\r\n                            </p>\r\n                            <p>\r\n                                Best regards,</br>\r\n                                <b>CnapxPay Team</b>\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div class=\"card-panel lighten-4 z-depth-0\">\r\n                            <div class=\"white-text center-align\">\r\n                                <input type=\"submit\" \r\n                                    class=\"btn white-text text-darken-3 purple darken-3 z-depth-1\" value=\"Login Now\">\r\n                            </div>\r\n                        </div>\r\n\r\n                        <p><div class=\"divider\"></div></p>\r\n                        <p class=\"right-align\">\r\n                            <small>\r\n                                <i>forgot your password ?</i>\r\n                                <a href=\"#\">click Here</a>\r\n                            </small>\r\n                        </p>\r\n                    </div>\r\n                </form>\r\n\r\n                <div class=\"col s12 m3 l3\"></div>\r\n\r\n                <div class=\"col s12 right-align\" style=\"margin-top: 6rem;\">\r\n                    <p><div class=\"divider\"></div></p>\r\n                    <small class=\"grey-text\"> Powered by </small>\r\n                    <b class=\"purple-text text-darken-3\">iservng</b>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        `;\r\n        (0,_utils_insert_into_DOM_js__WEBPACK_IMPORTED_MODULE_4__.insertIntoDOM)('main', content);\r\n\r\n        // Remove user infor \"customerInfo\" from session.\r\n        sessionStorage.removeItem('customerInfo');\r\n\r\n        //Register event handler for signupCompletedForm\r\n        if(document.querySelector('#signupCompletedForm'))\r\n        {\r\n            document.querySelector('#signupCompletedForm').addEventListener('submit', e => {\r\n                e.preventDefault();\r\n                __webpack_require__.e(/*! import() */ \"src_main_customer_login_interface_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../../main/customer_login_interface.js */ \"./src/main/customer_login_interface.js\"))\r\n                .then(m => {\r\n                    let loginUi = new m.CustomerLoginInterface();\r\n                    loginUi.createUi();\r\n                })\r\n                .catch(error => {\r\n                    console.log(error.message);\r\n                    (0,_utils_toast_it_js__WEBPACK_IMPORTED_MODULE_1__.toastIt)('red', 'Unable to load the login UI');\r\n                });\r\n            }, false);\r\n        }\r\n\r\n\r\n        //Register event handler for dashdashboard\r\n        if(document.querySelector('.dashboard'))\r\n        {\r\n            document.querySelector('.dashboard').addEventListener('click', e => {\r\n                e.preventDefault();\r\n                __webpack_require__.e(/*! import() */ \"src_main_admin_customer_profile_dashboard_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../../main/admin_customer_profile_dashboard.js */ \"./src/main/admin_customer_profile_dashboard.js\"))\r\n                .then(m => {\r\n                    let dashboard = new m.AdminProfileDashboard();\r\n                    dashboard.createUi();\r\n                })\r\n                .catch(error => {\r\n                    console.log(error.message);\r\n                    (0,_utils_toast_it_js__WEBPACK_IMPORTED_MODULE_1__.toastIt)('red', 'Unable to load the Dashboard');\r\n                });\r\n            }, false);\r\n        }\r\n        //agent_dashboard\r\n        if(document.querySelector('.agent_dashboard'))\r\n        {\r\n            document.querySelector('.agent_dashboard').addEventListener('click', e => {\r\n                e.preventDefault();\r\n                // import('../../main/admin_customer_profile_dashboard.js')\r\n                __webpack_require__.e(/*! import() */ \"src_main_agent_customer_profile_dashboard_js\").then(__webpack_require__.bind(__webpack_require__, /*! ../../main/agent_customer_profile_dashboard.js */ \"./src/main/agent_customer_profile_dashboard.js\"))\r\n                .then(m => {\r\n                    let userId = sessionStorage.getItem('userId');\r\n                    console.log('../../main/agent_customer_profile_dashboard.js', userId);\r\n                    let dashboard = new m.AgentProfileDashboard(userId);\r\n                    dashboard.createUi();\r\n                })\r\n                .catch(error => {\r\n                    console.log(error.message);\r\n                    (0,_utils_toast_it_js__WEBPACK_IMPORTED_MODULE_1__.toastIt)('red', 'Unable to load the Dashboard');\r\n                });\r\n            }, false);\r\n        }\r\n        // =============\r\n\r\n    }\r\n\r\n\r\n    #credentialsNotUnique(email, password)\r\n    {\r\n        let content = `\r\n        <div class=\"container\">\r\n            <div class=\"row\">\r\n                <div class=\"col s12 red\" style=\"margin-top: 3rem; margin-bottom: 2rem;\"><h5>Error!</h5></div>\r\n                <div class=\"col s12 m3 l3\"></div>\r\n                <div class=\"col s12 m6 l6\">\r\n                    This error could be atttributed to two issues as follows\r\n                    <ol>\r\n                        <li>\r\n                            The device is not connected or has lost network connection.\r\n                        </li>\r\n                        <li>\r\n                            The credential ${email} and ${password} are already in use, please create and use a unique email account for sign-up.\r\n                        </li>\r\n                    </ol>\r\n                    \r\n                    <p style=\"margin-top: 2rem;\">\r\n                        <a href=\".\" class=\"btn purple darken-3 try_again\">\r\n                            Try Again\r\n                        </a>\r\n                    </p>\r\n\r\n                </div>\r\n                <div class=\"col s12 m3 l3\"></div>\r\n            </div>\r\n        </div>\r\n        `;\r\n        (0,_utils_insert_into_DOM_js__WEBPACK_IMPORTED_MODULE_4__.insertIntoDOM)('main', content);\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://cnapx-trials/./src/modal/handlers/process_customer_registration_type.js?");

/***/ })

}]);